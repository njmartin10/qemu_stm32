@container_name = "qemu_container"
@docker_cmd = "docker run -it --name=#{@container_name} --rm qemu_stm32 /usr/local/bin/qemu-system-arm -M stm32-p103 -serial mon:stdio -monitor tcp:127.0.0.1:5900,server,nowait -kernel /stm32_p103_demos/demos/"

desc "Run the QEMU STM32 binary with docker"
task :demo, [:demo_name] do |t, args| 
    demo_bin="#{args[:demo_name]}/main.bin"
    system(@docker_cmd + demo_bin)
end

desc "Run the button demo in QEMU STM32 binary with docker"
task :btn do
    demo_bin="button/main.bin"
    system(@docker_cmd + demo_bin)
end

desc "Run the echo demo in QEMU STM32 binary with docker"
task :echo do
    demo_bin="uart_echo/main.bin"
    system(@docker_cmd + demo_bin)
end

desc "Debug running docker container"
task :dbg do
    system("docker exec -it #{@container_name} /bin/nc 127.0.0.1 5900")
end

desc "Run interactive shell"
task :int do
    system("docker run -it --name=#{@container_name} qemu_stm32 bash")
end

